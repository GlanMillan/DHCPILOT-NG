root@debianDocker:/DHCPLIOT-NG# ./scripts/reset_server.sh
[2025-03-27 15:21:34] 开始重置服务器...
此操作将删除所有配置和数据，是否继续？(y/n) y
[2025-03-27 15:21:35] 停止服务...
[2025-03-27 15:21:35] 停止PostgreSQL服务...
[2025-03-27 15:21:35] 清理Docker资源...

Total reclaimed space: 0B
[2025-03-27 15:21:37] 清理配置文件...
[2025-03-27 15:21:37] 清理用户和组...
userdel: redis mail spool (/var/mail/redis) not found
[2025-03-27 15:21:37] 清理dpkg statoverride...
[2025-03-27 15:21:37] 禁用系统服务...
Synchronizing state of postgresql.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install disable postgresql
Removed "/etc/systemd/system/multi-user.target.wants/postgresql.service".
[2025-03-27 15:21:38] 重置防火墙规则...
[2025-03-27 15:21:38] 卸载软件包...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following package was automatically installed and is no longer required:
  bind9-utils
Use 'apt autoremove' to remove it.
The following packages will be REMOVED:
  bind9 bind9-doc bind9utils dns-root-data
0 upgraded, 0 newly installed, 4 to remove and 0 not upgraded.
After this operation, 8750 kB disk space will be freed.
(Reading database ... 42708 files and directories currently installed.)
Removing bind9 (1:9.18.33-1~deb12u2) ...
Removing bind9-doc (1:9.18.33-1~deb12u2) ...
Removing bind9utils (1:9.18.33-1~deb12u2) ...
Removing dns-root-data (2024071801~deb12u1) ...
Processing triggers for man-db (2.11.2-2) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  bind9-utils
0 upgraded, 0 newly installed, 1 to remove and 0 not upgraded.
After this operation, 636 kB disk space will be freed.
(Reading database ... 42601 files and directories currently installed.)
Removing bind9-utils (1:9.18.33-1~deb12u2) ...
Processing triggers for man-db (2.11.2-2) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  liblog4cplus-2.0.5 libmariadb3 mariadb-common mysql-common
Use 'apt autoremove' to remove them.
The following packages will be REMOVED:
  kea-common kea-dhcp4-server
0 upgraded, 0 newly installed, 2 to remove and 0 not upgraded.
After this operation, 18.0 MB disk space will be freed.
(Reading database ... 42572 files and directories currently installed.)
Removing kea-dhcp4-server (2.2.0-6) ...
Removing kea-common (2.2.0-6) ...
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+deb12u10) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  liblog4cplus-2.0.5 libmariadb3 mariadb-common mysql-common
0 upgraded, 0 newly installed, 4 to remove and 0 not upgraded.
After this operation, 1362 kB disk space will be freed.
(Reading database ... 42504 files and directories currently installed.)
Removing liblog4cplus-2.0.5:amd64 (2.0.8-1) ...
Removing libmariadb3:amd64 (1:10.11.11-0+deb12u1) ...
Removing mariadb-common (1:10.11.11-0+deb12u1) ...
update-alternatives: using /etc/mysql/my.cnf.fallback to provide /etc/mysql/my.cnf (my.cnf) in auto mode
Removing mysql-common (5.8+1.1.0) ...
Processing triggers for libc-bin (2.36-9+deb12u10) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  postgresql postgresql-contrib
0 upgraded, 0 newly installed, 2 to remove and 0 not upgraded.
After this operation, 30.7 kB disk space will be freed.
(Reading database ... 42473 files and directories currently installed.)
Removing postgresql (15+248) ...
Removing postgresql-contrib (15+248) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  libatomic1 liblzf1
Use 'apt autoremove' to remove them.
The following packages will be REMOVED:
  redis-server redis-tools
0 upgraded, 0 newly installed, 2 to remove and 0 not upgraded.
After this operation, 6162 kB disk space will be freed.
(Reading database ... 42467 files and directories currently installed.)
Removing redis-server (5:7.0.15-1~deb12u3) ...
Removing redis-tools (5:7.0.15-1~deb12u3) ...
Processing triggers for man-db (2.11.2-2) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  libatomic1 liblzf1
0 upgraded, 0 newly installed, 2 to remove and 0 not upgraded.
After this operation, 86.0 kB disk space will be freed.
(Reading database ... 42436 files and directories currently installed.)
Removing libatomic1:amd64 (12.2.0-14) ...
Removing liblzf1:amd64 (3.6-3) ...
Processing triggers for libc-bin (2.36-9+deb12u10) ...
[2025-03-27 15:21:52] 服务器重置完成
root@debianDocker:/DHCPLIOT-NG# chmod 777 ./scripts/*.sh
root@debianDocker:/DHCPLIOT-NG# ./scripts/configure_server.sh
[2025-03-27 15:23:20] 开始配置服务器...
[2025-03-27 15:23:20] 检查系统要求...
[2025-03-27 15:23:20] 预处理：清理statoverride...
[2025-03-27 15:23:20] 删除Redis的statoverride记录...
[2025-03-27 15:23:20] 停止现有服务...
[2025-03-27 15:23:20] 停止Docker服务...
Warning: Stopping docker.service, but it can still be activated by:
  docker.socket
[2025-03-27 15:23:20] 安装必要的软件包...
Hit:1 http://security.debian.org/debian-security bookworm-security InRelease
Hit:2 http://mirrors.tuna.tsinghua.edu.cn/debian bookworm InRelease
Hit:3 http://mirrors.tuna.tsinghua.edu.cn/debian bookworm-updates InRelease
Ign:4 https://download.docker.com/linux/debian bookworm InRelease
Ign:4 https://download.docker.com/linux/debian bookworm InRelease
Ign:4 https://download.docker.com/linux/debian bookworm InRelease
Hit:4 https://download.docker.com/linux/debian bookworm InRelease
Reading package lists... Done
[2025-03-27 15:23:39] 安装 bind9...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  bind9-utils
Suggested packages:
  bind-doc resolvconf ufw
The following NEW packages will be installed:
  bind9 bind9-doc bind9-utils bind9utils dns-root-data
0 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/3913 kB of archives.
After this operation, 9386 kB of additional disk space will be used.
Selecting previously unselected package bind9-utils.
(Reading database ... 42427 files and directories currently installed.)
Preparing to unpack .../bind9-utils_1%3a9.18.33-1~deb12u2_amd64.deb ...
Unpacking bind9-utils (1:9.18.33-1~deb12u2) ...
Selecting previously unselected package dns-root-data.
Preparing to unpack .../dns-root-data_2024071801~deb12u1_all.deb ...
Unpacking dns-root-data (2024071801~deb12u1) ...
Selecting previously unselected package bind9.
Preparing to unpack .../bind9_1%3a9.18.33-1~deb12u2_amd64.deb ...
Unpacking bind9 (1:9.18.33-1~deb12u2) ...
Selecting previously unselected package bind9-doc.
Preparing to unpack .../bind9-doc_1%3a9.18.33-1~deb12u2_all.deb ...
Unpacking bind9-doc (1:9.18.33-1~deb12u2) ...
Selecting previously unselected package bind9utils.
Preparing to unpack .../bind9utils_1%3a9.18.33-1~deb12u2_all.deb ...
Unpacking bind9utils (1:9.18.33-1~deb12u2) ...
Setting up bind9-doc (1:9.18.33-1~deb12u2) ...
Setting up dns-root-data (2024071801~deb12u1) ...
Setting up bind9-utils (1:9.18.33-1~deb12u2) ...
Setting up bind9 (1:9.18.33-1~deb12u2) ...
wrote key file "/etc/bind/rndc.key"
chgrp: cannot access '/etc/bind/named.conf*': No such file or directory
chmod: cannot access '/etc/bind/named.conf*': No such file or directory
named-resolvconf.service is a disabled or a static unit not running, not starting it.
named.service is a disabled or a static unit not running, not starting it.
Setting up bind9utils (1:9.18.33-1~deb12u2) ...
Processing triggers for man-db (2.11.2-2) ...
[2025-03-27 15:23:44] 安装 kea-dhcp4-server...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  liblog4cplus-2.0.5 libmariadb3 mariadb-common mysql-common
Suggested packages:
  kea-doc
The following NEW packages will be installed:
  kea-common kea-dhcp4-server liblog4cplus-2.0.5 libmariadb3 mariadb-common mysql-common
0 upgraded, 6 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/4653 kB of archives.
After this operation, 19.4 MB of additional disk space will be used.
Selecting previously unselected package liblog4cplus-2.0.5:amd64.
(Reading database ... 42563 files and directories currently installed.)
Preparing to unpack .../0-liblog4cplus-2.0.5_2.0.8-1_amd64.deb ...
Unpacking liblog4cplus-2.0.5:amd64 (2.0.8-1) ...
Selecting previously unselected package mysql-common.
Preparing to unpack .../1-mysql-common_5.8+1.1.0_all.deb ...
Unpacking mysql-common (5.8+1.1.0) ...
Selecting previously unselected package mariadb-common.
Preparing to unpack .../2-mariadb-common_1%3a10.11.11-0+deb12u1_all.deb ...
Unpacking mariadb-common (1:10.11.11-0+deb12u1) ...
Selecting previously unselected package libmariadb3:amd64.
Preparing to unpack .../3-libmariadb3_1%3a10.11.11-0+deb12u1_amd64.deb ...
Unpacking libmariadb3:amd64 (1:10.11.11-0+deb12u1) ...
Selecting previously unselected package kea-common.
Preparing to unpack .../4-kea-common_2.2.0-6_amd64.deb ...
Unpacking kea-common (2.2.0-6) ...
Selecting previously unselected package kea-dhcp4-server.
Preparing to unpack .../5-kea-dhcp4-server_2.2.0-6_amd64.deb ...
Unpacking kea-dhcp4-server (2.2.0-6) ...
Setting up mysql-common (5.8+1.1.0) ...
update-alternatives: using /etc/mysql/my.cnf.fallback to provide /etc/mysql/my.cnf (my.cnf) in auto mode
Setting up liblog4cplus-2.0.5:amd64 (2.0.8-1) ...
Setting up mariadb-common (1:10.11.11-0+deb12u1) ...
update-alternatives: using /etc/mysql/mariadb.cnf to provide /etc/mysql/my.cnf (my.cnf) in auto mode
Setting up libmariadb3:amd64 (1:10.11.11-0+deb12u1) ...
Setting up kea-common (2.2.0-6) ...
addgroup: The group `_kea' already exists as a system group. Exiting.
Setting up kea-dhcp4-server (2.2.0-6) ...
kea-dhcp4-server.service is a disabled or a static unit not running, not starting it.
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+deb12u10) ...
[2025-03-27 15:23:48] 安装 postgresql...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Suggested packages:
  postgresql-doc
The following NEW packages will be installed:
  postgresql postgresql-contrib
0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/20.2 kB of archives.
After this operation, 30.7 kB of additional disk space will be used.
Selecting previously unselected package postgresql.
(Reading database ... 42662 files and directories currently installed.)
Preparing to unpack .../postgresql_15+248_all.deb ...
Unpacking postgresql (15+248) ...
Selecting previously unselected package postgresql-contrib.
Preparing to unpack .../postgresql-contrib_15+248_all.deb ...
Unpacking postgresql-contrib (15+248) ...
Setting up postgresql-contrib (15+248) ...
Setting up postgresql (15+248) ...
[2025-03-27 15:23:49] 安装 redis-server...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  libatomic1 liblzf1
Suggested packages:
  ruby-redis
The following NEW packages will be installed:
  libatomic1 liblzf1 redis-server redis-tools
0 upgraded, 4 newly installed, 0 to remove and 0 not upgraded.
Need to get 0 B/1082 kB of archives.
After this operation, 6248 kB of additional disk space will be used.
Selecting previously unselected package libatomic1:amd64.
(Reading database ... 42668 files and directories currently installed.)
Preparing to unpack .../libatomic1_12.2.0-14_amd64.deb ...
Unpacking libatomic1:amd64 (12.2.0-14) ...
Selecting previously unselected package liblzf1:amd64.
Preparing to unpack .../liblzf1_3.6-3_amd64.deb ...
Unpacking liblzf1:amd64 (3.6-3) ...
Selecting previously unselected package redis-tools.
Preparing to unpack .../redis-tools_5%3a7.0.15-1~deb12u3_amd64.deb ...
Unpacking redis-tools (5:7.0.15-1~deb12u3) ...
Selecting previously unselected package redis-server.
Preparing to unpack .../redis-server_5%3a7.0.15-1~deb12u3_amd64.deb ...
Unpacking redis-server (5:7.0.15-1~deb12u3) ...
Setting up liblzf1:amd64 (3.6-3) ...
Setting up libatomic1:amd64 (12.2.0-14) ...
Setting up redis-tools (5:7.0.15-1~deb12u3) ...
Setting up redis-server (5:7.0.15-1~deb12u3) ...
redis-server.service is a disabled or a static unit not running, not starting it.
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+deb12u10) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (7.88.1-10+deb12u12).
wget is already the newest version (1.21.3-1+deb12u1).
net-tools is already the newest version (2.10-0.1).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
[2025-03-27 15:23:53] 配置PostgreSQL...
Synchronizing state of postgresql.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable postgresql
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql.service -> /lib/systemd/system/postgresql.service.
[2025-03-27 15:23:59] 创建postgres用户...
[2025-03-27 15:23:59] 初始化PostgreSQL数据库...
su: warning: cannot change directory to /home/postgres: No such file or directory
